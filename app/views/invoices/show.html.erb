<div class="d-flex justify-content-between align-items-center">
  <h1 class="mb-0"><%= @invoice.number %></h1>
  <div class="d-flex align-items-center gap-2">
    <%= status_badge(@invoice.status) %>
    <%= link_to t("invoices.actions.open_pdf", default: "Open PDF"),
                invoice_path(@invoice, format: :pdf),
                class: "btn btn-outline-primary btn-sm",
                target: "_blank", rel: "noopener" %>
    <% unless @invoice.status_paid? || @invoice.status_canceled? %>
      <%= button_to t("invoices.actions.pay", default: "Pay"),
                    pay_invoice_path(@invoice),
                    method: :post,
                    class: "btn btn-success btn-sm" %>
    <% end %>
  </div>
</div>

<hr class="my-3" />

<p class="mb-1">
  <strong><%= t("activerecord.models.client.one") %>:</strong>
  <%= link_to @invoice.client.name, @invoice.client %>
</p>
<p class="mb-1">
  <strong><%= t("activerecord.attributes.invoice.issued_on") %>:</strong>
  <%= @invoice.issued_on %>
</p>
<p class="mb-3">
  <strong><%= t("activerecord.attributes.invoice.due_date") %>:</strong>
  <%= @invoice.due_date %>
</p>

<table class="table">
  <thead>
    <tr>
      <th><%= t("invoices.item", default: t("invoices.items.item", default: "Item")) %></th>
      <th class="text-end"><%= t("invoices.quantity", default: t("invoices.items.quantity", default: "Qty")) %></th>
      <th class="text-end"><%= t("invoices.unit_price", default: t("invoices.items.unit_price", default: "Unit price")) %></th>
      <th class="text-end"><%= t("invoices.total", default: t("invoices.items.total", default: "Total")) %></th>
    </tr>
  </thead>
  <tbody>
    <% @invoice.invoice_items.each do |li| %>
      <tr>
        <td>
          <strong><%= li.name %></strong>
          <% if li.description.present? %><br/><small class="text-muted"><%= li.description %></small><% end %>
        </td>
        <td class="text-end"><%= li.quantity %></td>
        <td class="text-end"><%= money_cents(li.unit_price_cents, @invoice.currency) %></td>
        <td class="text-end"><%= money_cents(li.total_cents, @invoice.currency) %></td>
      </tr>
    <% end %>
  </tbody>
  <tfoot>
    <tr>
      <th colspan="3" class="text-end"><%= t("invoices.subtotal", default: t("invoices.items.subtotal", default: "Subtotal")) %></th>
      <th class="text-end"><%= money_cents(@invoice.total_cents, @invoice.currency) %></th>
    </tr>
  </tfoot>
</table>

<hr class="my-3" />

<h5 class="mb-2"><%= t("invoices.actions.send_now", default: "Send now") %></h5>
<div class="d-flex gap-2 flex-wrap mb-3">
  <%= button_to t("invoices.mail.created",  default: "Send: Created"),
                send_created_invoice_path(@invoice),
                method: :post, class: "btn btn-outline-secondary" %>

  <%= button_to t("invoices.mail.due",      default: "Send: Due reminder"),
                send_due_invoice_path(@invoice),
                method: :post, class: "btn btn-outline-warning" %>

  <%= button_to t("invoices.mail.overdue",  default: "Send: Overdue"),
                send_overdue_invoice_path(@invoice),
                method: :post, class: "btn btn-outline-danger" %>

  <%= button_to t("invoices.mail.paid",     default: "Send: Paid thank you"),
                send_paid_invoice_path(@invoice),
                method: :post, class: "btn btn-outline-success" %>
</div>

<div class="mt-3">
  <%= link_to t("helpers.edit"), edit_invoice_path(@invoice), class: "btn btn-outline-secondary" %>
  <%= link_to t("helpers.back"), invoices_path, class: "btn btn-secondary" %>
</div>
